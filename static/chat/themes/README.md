# Руководство по управлению темами чата

Этот документ содержит пошаговые инструкции для агентов по добавлению новых тем в систему чата.

## Структура папки тем

```
static/chat/themes/
├── theme-scanner.js           # Модуль сканирования тем
├── themes-registry.json       # Реестр всех тем
├── README.md                  # Данное руководство
├── focus/                     # Пример встроенной темы
│   ├── theme.json            # Метаданные темы
│   └── theme.css             # CSS файл темы
├── devin-free/               # Пример внешней темы
└── startbootstrap-sb-admin-gh-pages-free/  # Пример внешней темы
```

## Шаг 1: Создание папки новой темы

1. Создайте новую папку в `static/chat/themes/` с уникальным именем темы
2. Имя папки должно соответствовать ID темы (только латинские буквы, цифры, дефисы)
3. Пример: `static/chat/themes/my-new-theme/`

## Шаг 2: Создание файла метаданных (theme.json)

Создайте файл `theme.json` в папке темы со следующей структурой:

```json
{
  "id": "my-new-theme",
  "name": "Моя новая тема",
  "description": "Описание темы для пользователей",
  "version": "1.0.0",
  "author": "Имя автора",
  "license": "MIT",
  "category": "external",
  "tags": ["tag1", "tag2", "custom"],
  "bootstrap_version": "5.3.0",
  "preview_image": "preview.jpg",
  "icon": "bi-palette",
  "files": {
    "css": "theme.css",
    "js": null,
    "assets": "assets/"
  },
  "color_modes": ["light", "dark"],
  "features": [
    "Особенность 1",
    "Особенность 2",
    "Особенность 3"
  ],
  "installation_date": "2024-01-15T10:30:00Z",
  "last_updated": "2024-01-15T10:30:00Z"
}
```

### Обязательные поля:
- `id` - уникальный идентификатор темы (совпадает с именем папки)
- `name` - отображаемое имя темы
- `description` - описание темы
- `category` - категория темы (`builtin`, `external`, `custom`)
- `icon` - иконка темы (Bootstrap Icons класс, например: `bi-palette`, `bi-sun-fill`, `bi-moon-fill`)

### Опциональные поля:
- `version` - версия темы
- `author` - автор темы
- `license` - лицензия (MIT, GPL, Commercial, etc.)
- `enabled` - включение/отключение темы (по умолчанию `true`)
- `tags` - теги для поиска и категоризации
- `bootstrap_version` - версия Bootstrap
- `preview_image` - имя файла превью (относительно папки темы)
- `files.css` - имя CSS файла темы
- `files.js` - имя JS файла темы (если есть)
- `files.assets` - папка с ресурсами темы
- `color_modes` - поддерживаемые цветовые режимы
- `features` - список особенностей темы
- `installation_date` - дата установки (ISO 8601)
- `last_updated` - дата последнего обновления (ISO 8601)

## Шаг 3: Создание CSS файла темы

Создайте CSS файл (обычно `theme.css`) с определением темы:

```css
/**
 * Название темы - описание
 * Основана на Bootstrap 5.3+ CSS переменных
 */

[data-bs-theme="my-new-theme"] {
  /* Основные цвета */
  --bs-body-bg: #ffffff;
  --bs-body-color: #212529;
  --bs-text-muted: #6c757d;
  
  /* Акцентные цвета */
  --bs-primary: #0d6efd;
  --bs-primary-rgb: 13, 110, 253;
  --bs-secondary: #6c757d;
  --bs-secondary-rgb: 108, 117, 125;
  
  /* Состояния */
  --bs-success: #198754;
  --bs-success-rgb: 25, 135, 84;
  --bs-info: #0dcaf0;
  --bs-info-rgb: 13, 202, 240;
  --bs-warning: #ffc107;
  --bs-warning-rgb: 255, 193, 7;
  --bs-danger: #dc3545;
  --bs-danger-rgb: 220, 53, 69;
  
  /* Границы и разделители */
  --bs-border-color: #dee2e6;
  --bs-border-color-translucent: rgba(0, 0, 0, 0.175);
  --bs-border-radius: 0.375rem;
  --bs-border-width: 1px;
  
  /* Фон компонентов */
  --bs-tertiary-bg: #f8f9fa;
  --bs-secondary-bg: #e9ecef;
}

/* Дополнительные стили для конкретных компонентов */
[data-bs-theme="my-new-theme"] .sidebar {
  /* Стили для сайдбара */
}

[data-bs-theme="my-new-theme"] .main-content {
  /* Стили для основного контента */
}
```

### Важные принципы:
1. Используйте CSS переменные Bootstrap (`--bs-*`)
2. Все стили должны быть в селекторе `[data-bs-theme="theme-id"]`
3. Определите как минимум основные цвета и состояния
4. Учитывайте совместимость с существующими компонентами

## Шаг 4: Добавление ресурсов (опционально)

Если тема использует дополнительные ресурсы:

1. Создайте папку `assets/` в папке темы
2. Добавьте изображения, шрифты, иконки
3. Создайте файл превью `preview.jpg` (рекомендуемый размер: 300x200px)

## Шаг 5: Обновление реестра тем

**ОБЯЗАТЕЛЬНО**: Для добавления новой темы необходимо обновить реестр тем `themes-registry.json`:

1. Откройте файл `static/chat/themes/themes-registry.json`
2. Добавьте объект новой темы в массив `themes`
3. Обновите поля `last_scan` и `total_count`

**ВАЖНО**: Система теперь работает исключительно через реестр тем. Темы, не добавленные в реестр, не будут отображаться в интерфейсе.

### Управление включением/отключением тем

Каждая тема в реестре может быть включена или отключена с помощью поля `enabled`:

- `"enabled": true` - тема включена и отображается в выпадающем списке (по умолчанию)
- `"enabled": false` - тема отключена и скрыта из выпадающего списка

Отключенные темы не отображаются пользователям, но остаются в реестре для возможного включения в будущем.

Пример добавления:

```json
{
  "themes": [
    // ... существующие темы ...
    {
      "id": "my-new-theme",
      "name": "Моя новая тема",
      "description": "Описание темы",
      "version": "1.0.0",
      "author": "Имя автора",
      "license": "MIT",
      "category": "external",
      "tags": ["custom", "modern"],
      "bootstrap_version": "5.3.0",
      "preview_image": "preview.jpg",
      "icon": "bi-palette",
      "enabled": true,
      "files": {
        "css": "theme.css",
        "js": null
      },
      "color_modes": ["light"],
      "features": ["Современный дизайн", "Высокая контрастность"],
      "installation_date": "2024-01-15T10:30:00Z",
      "last_updated": "2024-01-15T10:30:00Z"
    }
  ],
  "last_scan": "2024-01-15T10:30:00Z",
  "total_count": 4
}
```

## Шаг 6: Тестирование темы

1. Обновите страницу чата
2. Откройте селектор тем в сайдбаре (внизу)
3. Найдите новую тему в выпадающем списке
4. Примените тему и проверьте отображение
5. Нажмите кнопку информации (i) рядом с селектором для просмотра деталей

## Категории тем

### builtin
- Встроенные темы проекта
- Загружаются автоматически
- Примеры: light, dark
- Иконки: `bi-sun-fill` (светлая), `bi-moon-fill` (темная)

### external
- Темы от внешних источников
- Скачанные с сайтов тем Bootstrap
- Примеры: test-brown-theme, devin-free, startbootstrap-sb-admin-gh-pages-free
- Должны быть добавлены в реестр тем для отображения
- Рекомендуемые иконки: `bi-palette`, `bi-palette-fill`, `bi-speedometer2`

### custom
- Пользовательские темы
- Созданные специально для проекта
- Корпоративные темы
- Рекомендуемые иконки: `bi-brush`, `bi-paint-bucket`

## Устранение неполадок

### Тема не появляется в списке
1. Проверьте правильность структуры папки
2. Убедитесь, что файл `theme.json` корректен (валидный JSON)
3. Проверьте, что `id` в `theme.json` совпадает с именем папки
4. Обновите страницу или очистите кэш браузера

### Тема не применяется
1. Проверьте наличие CSS файла, указанного в `files.css`
2. Убедитесь, что CSS использует правильный селектор `[data-bs-theme="theme-id"]`
3. Проверьте консоль браузера на наличие ошибок

### CSS не загружается
1. Проверьте путь к CSS файлу в `theme.json`
2. Убедитесь, что файл доступен по HTTP
3. Проверьте права доступа к файлу

## Рекомендации по созданию тем

### Дизайн
1. Следуйте принципам Bootstrap дизайн-системы
2. Обеспечьте достаточный контраст для читаемости
3. Тестируйте на разных размерах экрана
4. Учитывайте доступность (WCAG guidelines)

### Производительность
1. Минимизируйте размер CSS файлов
2. Используйте CSS переменные вместо дублирования стилей
3. Избегайте сложных селекторов и глубокой вложенности

### Совместимость
1. Тестируйте с существующими компонентами чата
2. Проверяйте работу с markdown, диаграммами, формами
3. Убедитесь в корректном отображении уведомлений

## Примеры готовых тем

### Минималистичная тема
```css
[data-bs-theme="minimal"] {
  --bs-body-bg: #ffffff;
  --bs-body-color: #333333;
  --bs-primary: #000000;
  --bs-border-color: #e0e0e0;
  --bs-border-radius: 0;
}
```

### Темная тема с акцентом
```css
[data-bs-theme="dark-accent"] {
  --bs-body-bg: #1a1a1a;
  --bs-body-color: #ffffff;
  --bs-primary: #00ff88;
  --bs-secondary: #333333;
  --bs-border-color: #444444;
}
```

## Автоматизация

Система автоматически:
1. Загружает темы из реестра `themes-registry.json` при загрузке страницы
2. Сканирует только папки тем, указанные в реестре
3. Обновляет выпадающий список с иконками из реестра
4. Кэширует CSS файлы для быстрой загрузки
5. Сохраняет выбранную тему в localStorage

**Изменения в системе**:
- Удален статический список известных тем из кода
- Все темы (включая иконки) теперь берутся из реестра
- Для добавления новой темы достаточно обновить только реестр

## Поддержка

При возникновении проблем:
1. Проверьте консоль браузера на наличие ошибок
2. Убедитесь в корректности JSON файлов
3. Проверьте пути к файлам
4. Обратитесь к документации Bootstrap 5.3+

## Рекомендуемые иконки Bootstrap Icons

Для разных типов тем рекомендуется использовать следующие иконки:

### Светлые темы
- `bi-sun` или `bi-sun-fill`
- `bi-brightness-high`

### Темные темы
- `bi-moon` или `bi-moon-fill`
- `bi-brightness-low`

### Цветные/кастомные темы
- `bi-palette` или `bi-palette-fill`
- `bi-brush` или `bi-brush-fill`
- `bi-paint-bucket`

### Админ/деловые темы
- `bi-speedometer` или `bi-speedometer2`
- `bi-grid` или `bi-grid-fill`
- `bi-layout-sidebar`

### Минималистичные темы
- `bi-circle` или `bi-circle-fill`
- `bi-square` или `bi-square-fill`

## Управление темами через реестр

### Включение и отключение тем

Для временного отключения темы без удаления из системы:

1. Откройте `static/chat/themes/themes-registry.json`
2. Найдите нужную тему в массиве `themes`
3. Установите `"enabled": false` для отключения или `"enabled": true` для включения
4. Сохраните файл

Отключенные темы:
- Не отображаются в выпадающем списке выбора тем
- Остаются в реестре для возможного включения
- Сохраняют все свои метаданные и файлы

### Пример отключения темы

```json
{
  "id": "my-theme",
  "name": "Моя тема",
  "enabled": false,
  // ... остальные поля
}
```

---

**Последнее обновление**: 2025-09-10
**Версия документа**: 2.1.0